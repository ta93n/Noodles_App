<script src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.credentials.GCP[:API_KEY] %>&callback=initMap" async defer></script>

<script>
var geocoder;
var map;
var marker;
var infoWindow;

function initMap() {
  geocoder = new google.maps.Geocoder();
  geocoder.geocode({
  'address': "<%= @post.shop_name + " " + @post.nearest %>"
  }, function(results, status) {
    if (status === google.maps.GeocoderStatus.OK) {
      map = new google.maps.Map(document.getElementById('map'), {
        center: results[0].geometry.location,
        zoom: 15
      });
      marker = new google.maps.Marker({
        position: results[0].geometry.location,
        map: map
      });
      infoWindow = new google.maps.InfoWindow({
        content: "八王子"
      });
      marker.addListener('click', function() {
        infoWindow.open(map, marker);
      });
    } else {
      alert("地図の表示ができませんでした。店名と最寄駅を確認して下さい。");
    }
  });
}
</script>
